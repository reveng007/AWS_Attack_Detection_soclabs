# 11.SOCLabs: Download EC2 Instance User Data

https://www.soc-labs.top/en/detections/91

## Goal: Write detection rules to identify behavior where EC2 instance user data is accessed via APIs, with particular attention to abnormal operations involving multiple user data retrievals within a short time frame.

## Detailed Reasoning :

1. Searched here: https://docs.aws.amazon.com/ (for: `ec2`)
2. Searched here: https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_Operations.html (for: "Describe" - tbh: `DescribeInstanceAttribute` is basically being used here)
3. Searched here: https://docs.aws.amazon.com/ec2-instance-connect/latest/APIReference/API_Operations.html (not needed)
4. Jotted down links:
    - https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeInstanceAttribute.html


```yaml
title: Download EC2 Instance User Data
status: test
description: Download EC2 Instance User Data
references:
    - https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_DescribeInstanceAttribute.html
author: Soumyanil Biswas
date: 2025-10-15
modified: 2025-10-15
tags:
    - attack.xxxx
logsource:
    product: aws
    service: cloudtrail
detection:
    selection:
        eventSource: ec2.amazonaws.com
        eventType: AwsApiCall
        
        eventName: DescribeInstanceAttribute
        requestParameters.attribute: userData
        
    condition: selection 
falsepositives:
    - unknown
level: high
fields:
    - eventName
    - sourceIPAddress
    - eventID
    - eventSource
    - userIdentity.arn
```
