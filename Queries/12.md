# 12.SOCLabs: Enumerate SES Information Activities

https://www.soc-labs.top/en/detections/92

## Goal:
Develop detection rules to identify SES enumeration activities, with particular attention to scenarios where :
SES configuration queries（GetAccountSendingEnabled）, 
quota queries（GetSendQuota）, 
identity enumeration（ListIdentities）, 
and identity verification status checks（GetIdentityVerificationAttributes）occur simultaneously. 

Focus on identifying suspicious activity where the same user or access key triggers multiple related API calls within a short period.

## Detailed Reasoning :

## Sigma Query:

```yaml
title: Enumerate SES Information Activities
status: test
description: Enumerate SES Information Activities
references:
    # More Details can be found here:
    - https://permiso.io/blog/s/aws-ses-pionage-detecting-ses-abuse/
    - https://docs.aws.amazon.com/ses/latest/APIReference/API_ListIdentities.html
    - https://docs.aws.amazon.com/ses/latest/APIReference/API_GetAccountSendingEnabled.html
    - https://docs.aws.amazon.com/servicequotas/2019-06-24/apireference/API_ListServiceQuotas.html
    - https://docs.aws.amazon.com/ses/latest/APIReference/API_GetSendQuota.html
    - https://docs.aws.amazon.com/ses/latest/APIReference-V2/API_GetAccount.html
    - https://docs.aws.amazon.com/ses/latest/APIReference/API_UpdateAccountSendingEnabled.html
    - https://docs.aws.amazon.com/ses/latest/APIReference/API_GetAccountSendingEnabled.html
author: Soumyanil Biswas
date: 2025-10-16
modified: 2025-10-16
tags:
    - attack.xxxx
logsource:
    product: aws
    service: cloudtrail
detection:
    selection:
        eventSource: ses.amazonaws.com
        eventType: AwsApiCall
        
        # identity enumeration: Provide the attacker with knowledge of how SES senders is configured within an AWS account
        eventName: ListIdentities

        # identity verification status checks: Provides attacker with information whether if there are any verified senders.
        eventName: GetIdentityVerificationAttributes

        # Checking for SandBox Mode: One can only send mail to verified email addresses and domains, if yes, attack can't be done.
        # The account cannot send to any address that is not verified.
        eventName: ListServiceQuotas
        eventName: GetSendQuota
        eventName: GetAccount
        
        # If using the above API call, response is not 200, then attacker would procede further and use the below mentioned APIs to
        # ensure the compromised account is capable of sending messages.
        eventName: UpdateAccountSendingEnabled
        eventName: GetAccountSendingEnabled

    condition: selection 
falsepositives:
    - unknown
level: high
fields:
    - eventName
    - sourceIPAddress
    - eventID
    - eventSource
    - userIdentity.arn
```

## Query Result:

<img width="1807" height="199" alt="image" src="https://github.com/user-attachments/assets/d60fd6be-62bc-46af-9d05-e8bd11c6beae" />

