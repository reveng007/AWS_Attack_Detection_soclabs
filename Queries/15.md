# 15.SOCLabs: Data Theft via Shared AMI

https://www.soc-labs.top/en/detections/95

## Goal: 
Write detection rules to identify behaviors where AMIs are shared with other accounts.

## Detailed Reasoning :
1. Attackers can share AMI via making them public.
2. Attackers can share AMI via sharing them to their own AWS Accounts.
3. In this case, they are sharing AMI with their acoount.

## Sigma Query:

```yaml
title: Data Theft via Shared AMI
status: test
description: Data Theft via Shared AMI
references:
    - https://stratus-red-team.cloud/attack-techniques/AWS/aws.exfiltration.ec2-share-ami/
    - https://docs.aws.amazon.com/AWSEC2/latest/APIReference/API_ModifyImageAttribute.html
author: Soumyanil Biswas
date: 2025-10-18
modified: 2025-10-18
tags:
    - attack.xxxx
logsource:
    product: aws
    service: cloudtrail
detection:
    selection:
        eventSource: ec2.amazonaws.com
        eventType: AwsApiCall
        
        eventName: ModifyImageAttribute

        requestParameters.attributeType: launchPermission
        requestParameters.imageId|re: '^ami-'

    condition: selection 
falsepositives:
    - unknown
level: high
fields:
    - eventName
    - sourceIPAddress
    - eventID
    - eventSource
    - userIdentity.arn
    - userIdentity.arn
```

## Query Result:

<img width="1800" height="242" alt="image" src="https://github.com/user-attachments/assets/5a0a09f0-bb27-4500-a1a1-35018ef54bbe" />

