# SOCLabs: EC2 Credential Exfiltration â€“ EC2 Account Credentials Used by Another AWS Account:

link: https://www.soc-labs.top/en/detections/83

## Detailed Reasoning :

```
identityAccountId: 103164125733
issuerAccountId: 438465128930
recipientAccountId: 438465128930
userIdentity.accountId: 103164125733
userIdentity.sessionContext.sessionIssuer.accountId: 438465128930
```

```yaml
title: EC2 Credential Exfiltration
status: test
description: EC2 Credential Exfiltration - EC2 Account Credentials Used by Another AWS Account
references:
    - not attached
author: Soumyanil Biswas
date: 2025-10-14
modified: 2025-10-14
tags:
    - attack.credential-access
    - attack.xxxx
logsource:
    product: aws
    service: cloudtrail
detection:
    selection:
        #eventSource: ec2.amazonaws.com
        eventType: AwsApiCall
        userIdentity.type: AssumedRole
        userIdentity.arn: arn:aws:sts::103164125733:assumed-role/stratus-red-team-ec2-steal-credentials-role/i-02299a25947b0226d
    #filter_based_on_existance:
    #    userIdentity.accountId|exists: true
    #   userIdentity.sessionContext.sessionIssuer.accountId|exists: true
    #    identityAccountId|exists: true
    #    issuerAccountId|exists: true
    #    recipientAccountId|exists: true
    filter_based_on_same_account:
        # both accounts should match
        userIdentity.accountId: userIdentity.sessionContext.sessionIssuer.accountId
        identityAccountId: issuerAccountId
        identityAccountId: recipientAccountId
        identityAccountId: userIdentity.sessionContext.sessionIssuer.accountId
        userIdentity.accountId: issuerAccountId
        userIdentity.accountId: recipientAccountId
    condition: selection and not filter_based_on_same_account
falsepositives:
    - Won't it contain False Postives for Cross-account usecase ?
level: high
fields:
    - eventName
    - sourceIPAddress
    - eventID
    - eventSource
    - userIdentity.arn``
```
